
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting started with Ptypy &#8212; ptypy 0.8.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/header.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/ptypyicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Concepts and Classes" href="concept.html" />
    <link rel="prev" title="Quicklinks" href="../content.html" />
<link href='http://fonts.googleapis.com/css?family=PT+Sans|Ubuntu|Cuprum' rel='stylesheet' type='text/css'>

  </head><body>



<div class="pageheader">
  <ul>
    <li><a href="http://ptycho.github.io/ptypy">Home</a></li>
    <li><a href="http://www.github.com/ptycho/ptypy">Github</a></li>
    <li><a href="../content.html">Docs</a></li>
    <!-- <li><a href="develop.html">Extend/Develop</a></li> -->
  </ul>
  <div>
    <a href="../index.html"><img src="../_static/logo_60px.png" alt="SPHINX" /></a>

    <h0 style="padding-bottom:40px">Ptychography for Python</h0>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="concept.html" title="Concepts and Classes"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../content.html" title="Quicklinks"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../content.html">ptypy 0.8.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting started with Ptypy</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="getting-started-with-ptypy">
<span id="getting-started"></span><h1>Getting started with Ptypy<a class="headerlink" href="#getting-started-with-ptypy" title="Permalink to this headline">¶</a></h1>
<section id="installation">
<span id="id1"></span><h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<section id="general-installation-instructions">
<h3>General installation instructions<a class="headerlink" href="#general-installation-instructions" title="Permalink to this headline">¶</a></h3>
<p>Download and unpack <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> from the sources. For example, on Linux
systems you can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget https://github.com/ptycho/ptypy/archive/master.zip
$ unzip master.zip -d /tmp/; rm master.zip
</pre></div>
</div>
<p>or make a clone of the <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> github repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/ptycho/ptypy.git /tmp/ptypy-master
</pre></div>
</div>
<p>which will unpack the master branch of ptypy into <cite>/tmp/ptypy-master</cite> but
you are of course free to place the software wherever it is convenient for you.
In principle, next you only have to navigate to that directory and install with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install .
</pre></div>
</div>
<p>However, since <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> depends on a number of other packages, we recommend
installing it in a virtual environment using the
<a class="reference external" href="https://www.anaconda.com/">anaconda</a> package manager. Conveniently, this
installation route allows you to install <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> across platforms.</p>
<section id="essential-install">
<h4>Essential install<a class="headerlink" href="#essential-install" title="Permalink to this headline">¶</a></h4>
<p>Only three Python packages are essential for <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> to work:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.python.org/pypi/numpy">NumPy</a>
(homepage: <a class="reference external" href="http://www.numpy.org">http://www.numpy.org</a>)</p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/scipy">SciPy</a>
(homepage: <a class="reference external" href="http://www.scipy.org">http://www.scipy.org</a>)</p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/h5py">h5py</a>
(homepage: <a class="reference external" href="http://www.h5py.org">http://www.h5py.org</a>)</p></li>
</ul>
<p>Install the essential version like so</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda env create -f dependencies_core.yml
$ conda activate ptypy_core
(ptypy_core)$ pip install .
</pre></div>
</div>
</section>
<section id="recommended-install-for-additional-functionality">
<h4>Recommended install for additional functionality<a class="headerlink" href="#recommended-install-for-additional-functionality" title="Permalink to this headline">¶</a></h4>
<p>Please note that <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> is an alpha release and lacks rigorous import
checking. There may be parts of code that implicitly ask for any of the
packages listed here. Therefore, we recommend to install these packages.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.python.org/pypi/matplotlib">Matplotlib</a>
for any kind of plotting or image generation
(homepage: <a class="reference external" href="http://www.matplotlib.org">http://www.matplotlib.org</a>)</p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/mpi4py">mpi4py</a>
for CPU-node parallelization, contains python bindings for the
<a class="reference external" href="http://www.mcs.anl.gov/research/projects/mpi/">Message Passaging Interface</a>,
(homepage: <a class="reference external" href="https://bitbucket.org/mpi4py/mpi4py/">https://bitbucket.org/mpi4py/mpi4py/</a>)</p></li>
<li><p><a class="reference external" href="https://pypi.python.org/pypi/pyzmq">pyzmq</a>
for a threaded server on the main node to perfrom asynchronous
client-server communication, contains python bindings for the
ZeroMQ protocol,
(homepage: <a class="reference external" href="http://github.com/zeromq/pyzmq">http://github.com/zeromq/pyzmq</a>).
This package is needed for non-blocking plots of the reconstruction run
(e.g. for <a class="reference internal" href="#plotclient"><span class="std std-ref">Run a plotclient in a separate process</span></a>).</p></li>
</ul>
<p>Install the recommended version like so</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda env create -f dependencies_full.yml
$ conda activate ptypy_full
(ptypy_full)$ pip install .
</pre></div>
</div>
</section>
<section id="recommended-install-for-gpu-support-with-cupy">
<h4>Recommended install for GPU support with CuPy<a class="headerlink" href="#recommended-install-for-gpu-support-with-cupy" title="Permalink to this headline">¶</a></h4>
<p>We support an accelerated version of <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> for CUDA-capable
GPUs based on our own kernels and the
<a class="reference external" href="https://cupy.dev/">CuPy</a> package.</p>
<p>Install the dependencies for this version like so.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda env create -f ptypy/accelerate/cuda_cupy/dependencies.yml
$ conda activate ptypy_cupy
(ptypy_cupy)$ pip install .
</pre></div>
</div>
</section>
<section id="install-for-gpu-support-with-pycuda">
<h4>Install for GPU support with PyCUDA<a class="headerlink" href="#install-for-gpu-support-with-pycuda" title="Permalink to this headline">¶</a></h4>
<p>Alternatively, we also support an accelerated version of <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a> for CUDA-capable
GPUs based on our own kernels and the
<a class="reference external" href="https://pypi.org/project/pycuda/">PyCUDA</a> package.</p>
<p>Install the dependencies for this version like so.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda env create -f ptypy/accelerate/cuda_pycuda/dependencies.yml
$ conda activate ptypy_pycuda
(ptypy_pycuda)$ pip install .
</pre></div>
</div>
<p>We use <a class="reference external" href="https://pypi.org/project/reikna/">Reikna</a> to
provide a filtered FFT, i.e. a FFT that is fused with a pointwise matrix multiplication.</p>
</section>
<section id="optional-installation-of-filtered-cufft">
<h4>Optional installation of filtered cufft<a class="headerlink" href="#optional-installation-of-filtered-cufft" title="Permalink to this headline">¶</a></h4>
<p>For optimal performance with both CuPy and PyCUDA engines, you can optionally install a version
of the filtered FFT based on cufft and callbacks. Due to the nature of this extension it
needs to be built for fixed array sizes externally and currently supports array
sizes of 16, 32, 64, 128, 256, 512, 1024 and 2048.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda activate ptypy_cupy
(ptypy_cupy)$ cd cufft
(ptypy_cupy)$ conda env update --file dependencies.yml --name ptypy_cupy
(ptypy_cupy)$ pip install .
</pre></div>
</div>
</section>
<section id="optional-packages">
<h4>Optional packages<a class="headerlink" href="#optional-packages" title="Permalink to this headline">¶</a></h4>
<p>Other very useful packages are</p>
<ul class="simple">
<li><p><a class="reference external" href="https://pypi.python.org/pypi/ipython">Ipython</a>
(homepage: <a class="reference external" href="http://www.ipython.org">http://www.ipython.org</a>)</p></li>
</ul>
</section>
</section>
</section>
<section id="quickstart-with-a-minimal-script">
<span id="quickstart"></span><h2>Quickstart with a minimal script<a class="headerlink" href="#quickstart-with-a-minimal-script" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This tutorial was generated from the python source
<code class="file docutils literal notranslate"><span class="pre">[ptypy_root]/tutorial/minimal_script.py</span></code> using <code class="file docutils literal notranslate"><span class="pre">ptypy/doc/script2rst.py</span></code>.
You are encouraged to modify the parameters and rerun the tutorial with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python [ptypy_root]/tutorial/minimal_script.py
</pre></div>
</div>
</div>
<p>This tutorial explains the minimal settings to get a reconstruction
runnig in <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a>. A PtyPy script consists of two parts:</p>
<ul class="simple">
<li><p>Creation of a parameter tree with parameters
as listed in <a class="reference internal" href="parameters.html#parameters"><span class="std std-ref">Parameter tree structure</span></a> and</p></li>
<li><p>calling a <a class="reference internal" href="ptypy.core.html#ptypy.core.ptycho.Ptycho" title="ptypy.core.ptycho.Ptycho"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Ptycho</span></code></a> instance with this parameter tree,
specifying a level that determines how much the Ptycho
instance will do.</p></li>
</ul>
<section id="preparing-the-parameter-tree">
<h3>Preparing the parameter tree<a class="headerlink" href="#preparing-the-parameter-tree" title="Permalink to this headline">¶</a></h3>
<p>We begin with opening an empty python file of arbitrary name
in an editor of your choice, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ gedit minimal_script.py
</pre></div>
</div>
<p>Next we create an empty parameter tree. In PtyPy, parameters
are managed by the <a class="reference internal" href="ptypy.utils.html#ptypy.utils.parameters.Param" title="ptypy.utils.parameters.Param"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Param</span></code></a> class which is a convenience class subclassing Python’s
dict type. It is designed in such a way that dictionary items can be accessed also as
class attributes, making the scripts and code much more readable.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ptypy</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">u</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>  <span class="c1"># root level</span>
</pre></div>
</div>
<p>We set the verbosity to a high level, in order to have information on the
reconstruction process printed to the terminal.
See <a class="reference internal" href="parameters.html#ptycho.verbose_level" title="ptycho.verbose_level"><code class="xref py py-data docutils literal notranslate"><span class="pre">verbose_level</span></code></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">verbose_level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
</pre></div>
</div>
<p>We limit this reconstruction to single precision. The other choice is to
use double precision.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">data_type</span> <span class="o">=</span> <span class="s2">&quot;single&quot;</span>
</pre></div>
</div>
<p>We give this reconstruction the name <code class="docutils literal notranslate"><span class="pre">'minimal'</span></code> although it
will automatically choose one from the file name of the script if we put in
<code class="docutils literal notranslate"><span class="pre">None</span></code>. (But then the tutorial may not work on your computer as the chosen
run name may differ from the one that this tutorial was created with)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="s1">&#39;minimal&#39;</span>
</pre></div>
</div>
<p>Next, we set the home path. The <a class="reference internal" href="ptypy.core.html#ptypy.core.ptycho.Ptycho" title="ptypy.core.ptycho.Ptycho"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Ptycho</span></code></a> instance will use this
path as base for any other relative file path (e.g <code class="xref py py-data docutils literal notranslate"><span class="pre">io.autosave.path</span></code>
or <a class="reference internal" href="parameters.html#ptycho.io.rfile" title="ptycho.io.rfile"><code class="xref py py-data docutils literal notranslate"><span class="pre">io.rfile</span></code></a>). Relative paths lack a leading “/”
(or “C:\” on windows). Make sure to replace all “/” with “\”
if you run the scripts on a Windows system.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;/tmp/ptypy/&quot;</span>
</pre></div>
</div>
<p>We want an intermediate result of the reconstruction
to be dumped regularly every 20 reconstructions.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">autosave</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">autosave</span><span class="o">.</span><span class="n">interval</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
<p>In this tutorial we switch off the threaded plotting client.
(alternative one-liners would be <cite>p[‘io.autoplot.active’] = False</cite>
or <cite>p.io[‘autoplot.active’] = False</cite>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">autoplot</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">autoplot</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Since we do not want to plot anything, we don’t need the
interaction server either.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">interaction</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Now we have to insert actual parameters associated with a
ptychographic scan.</p>
<p>PtyPy is designed to support reconstruction from mutliple scans.
Each individual scan is represented by a branch in <code class="docutils literal notranslate"><span class="pre">scans</span></code>. The parameters
in these branches are those that differ from the <em>defaults</em> in the <code class="docutils literal notranslate"><span class="pre">scan</span></code>
branch mentioned above.
Obviously at least the <code class="docutils literal notranslate"><span class="pre">data</span></code> branch will differ from
<code class="xref py py-data docutils literal notranslate"><span class="pre">scan.data</span></code>. In this tutorial we
create a new scan parameter branch <code class="docutils literal notranslate"><span class="pre">MF</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Vanilla&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
</pre></div>
</div>
<p>As data source we have choosen the <em>‘MoonFlowerScan’</em> test source.
That will make PtyPy use the internal
<a class="reference internal" href="ptypy.core.html#ptypy.core.data.MoonFlowerScan" title="ptypy.core.data.MoonFlowerScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">MoonFlowerScan</span></code></a> class to generate data.
This class is meant for testing, and it provides/simulates
diffraction patterns without using the more complex generic
<code class="xref py py-class docutils literal notranslate"><span class="pre">SimScan</span></code> class.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;MoonFlowerScan&#39;</span>
</pre></div>
</div>
<p>We set the diffraction frame shape to a small value (128x128px) and
limit the number af diffraction patterns at 100. The
<a class="reference internal" href="ptypy.core.html#ptypy.core.data.MoonFlowerScan" title="ptypy.core.data.MoonFlowerScan"><code class="xref py py-class docutils literal notranslate"><span class="pre">MoonFlowerScan</span></code></a> instance will balance the
diffraction patterns accordingly.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">128</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>
</div>
<p>We skip saving the “prepared” data file for now. The PtyPy data
management is described in detail in <a class="reference internal" href="data_management.html#ptypy-data"><span class="std std-ref">Data management</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<p>Needlees to say, we need to specify a reconstruction engine. We choose
40 iterations of difference map algorithm.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">engines</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;DM&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">numiter</span> <span class="o">=</span> <span class="mi">40</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">numiter_contiguous</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</section>
<section id="running-ptypy">
<h3>Running ptypy<a class="headerlink" href="#running-ptypy" title="Permalink to this headline">¶</a></h3>
<p>We import the <a class="reference internal" href="ptypy.core.html#ptypy.core.ptycho.Ptycho" title="ptypy.core.ptycho.Ptycho"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Ptycho</span></code></a> class and pass the tree <code class="docutils literal notranslate"><span class="pre">p</span></code> at level 5.
This level tells <a class="reference internal" href="ptypy.core.html#ptypy.core.ptycho.Ptycho" title="ptypy.core.ptycho.Ptycho"><code class="xref any py py-class docutils literal notranslate"><span class="pre">Ptycho</span></code></a> to initialize everything and start the reconstruction
using all reconstruction engines in <code class="docutils literal notranslate"><span class="pre">p.engines</span></code> immediately upon construction.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ptypy.core</span> <span class="kn">import</span> <span class="n">Ptycho</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">P</span> <span class="o">=</span> <span class="n">Ptycho</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<p>From the terminal log, we note that there was an autosave every 20
iterations and the error reduced from iteration to iteration.</p>
</section>
</section>
<section id="utilies-binaries-for-convenience">
<span id="morescripts"></span><h2>Utilies/Binaries for convenience<a class="headerlink" href="#utilies-binaries-for-convenience" title="Permalink to this headline">¶</a></h2>
<p>PtyPy provides a few utility scripts to make life easier for you,
the user. They are located in <code class="docutils literal notranslate"><span class="pre">[ptypy_root]/scripts</span></code>.
In case of an install with conda, these are copied to <code class="docutils literal notranslate"><span class="pre">&lt;conda_env_dir&gt;/bin</span></code></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to the early stage of developmnet,
these scripts may see substantial changes in further releases, i.e.
the call signature may change.</p>
</div>
<section id="plotting-from-a-reconstruction-dump-file-ptyr">
<h3>Plotting from a reconstruction/dump file (*.ptyr)<a class="headerlink" href="#plotting-from-a-reconstruction-dump-file-ptyr" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">ptypy.plot</span></code> is an automatic plotting script that installs on Unix systems
It has the syntax</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.plot [-h] [-l LAYOUT] [-t IMFILE] ptyrfile
</pre></div>
</div>
<p>For our minimal example this translates to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.plot /tmp/ptypy/recons/minimal/minimal_DM.ptyr -t minimal.png
</pre></div>
</div>
<p>and the image looks like this (<a class="reference internal" href="#minimal-result"><span class="std std-numref">Fig. 1</span></a>)</p>
<figure class="highlights align-default" id="minimal-result">
<a class="reference internal image-reference" href="../_images/minimal_result.png"><img alt="../_images/minimal_result.png" src="../_images/minimal_result.png" style="width: 90%;" /></a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Example plot made with <code class="docutils literal notranslate"><span class="pre">ptypy.plot</span></code> using the <em>default</em> layput</span><a class="headerlink" href="#minimal-result" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="inspecting-a-hdf5-compatible-file">
<h3>Inspecting a hdf5 compatible file<a class="headerlink" href="#inspecting-a-hdf5-compatible-file" title="Permalink to this headline">¶</a></h3>
<p>Sometimes we want to quickly inspect what is in a <em>hdf5</em> file
that was created by PtyPy. For such cases, we can use <code class="docutils literal notranslate"><span class="pre">ptypy.inspect</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.inspect [-h] [-p PATH] [--report] [-d DEPTH] h5file
</pre></div>
</div>
<p>For example, a quick view at the top level can be realized with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.inspect /tmp/ptypy/recons/minimal/minimal_DM_0040.ptyr -d 1
</pre></div>
</div>
<p>which has the following the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">content</span> <span class="p">[</span><span class="n">Param</span> <span class="mi">5</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">obj</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">pars</span> <span class="p">[</span><span class="n">Param</span> <span class="mi">9</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">positions</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">probe</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">1</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">runtime</span> <span class="p">[</span><span class="n">Param</span> <span class="mi">8</span><span class="p">]:</span>
<span class="o">*</span> <span class="n">header</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">description</span> <span class="p">[</span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Ptypy .h5 compatible storage format&quot;</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">kind</span> <span class="p">[</span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;minimal&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>If we are interested solely in the probe we could use</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.inspect /tmp/ptypy/recons/minimal/minimal_DM.ptyr -d 1 -p content/probe
</pre></div>
</div>
<p>which has the following the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">SMF</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">20</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">DataTooSmall</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">ID</span> <span class="p">[</span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;SMF&quot;</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">_center</span> <span class="p">[</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mf">64.</span> <span class="mf">64.</span><span class="p">]]</span>
    <span class="o">*</span> <span class="n">_energy</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="mf">7.2</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">_origin</span> <span class="p">[</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">3.59918584e-06</span> <span class="o">-</span><span class="mf">3.59918584e-06</span><span class="p">]]</span>
    <span class="o">*</span> <span class="n">_pool</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">_psize</span> <span class="p">[</span><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.62372787e-08</span> <span class="mf">5.62372787e-08</span><span class="p">]]</span>
    <span class="o">*</span> <span class="n">_record</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="p">(</span><span class="sa">b</span><span class="s1">&#39;SMF&#39;</span><span class="p">,)]</span>
    <span class="o">*</span> <span class="n">_recs</span> <span class="p">[</span><span class="nb">dict</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="o">*</span> <span class="n">data</span> <span class="p">[</span><span class="mi">1</span><span class="n">x128x128</span> <span class="n">complex64</span> <span class="n">array</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">distributed</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">fill_value</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">grids</span> <span class="p">[</span><span class="nb">tuple</span> <span class="o">=</span> <span class="mi">2</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="n">x128x128</span> <span class="n">float64</span> <span class="n">array</span><span class="p">]]</span>
    <span class="o">*</span> <span class="n">layermap</span> <span class="p">[</span><span class="nb">list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="o">*</span> <span class="n">model_initialized</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="kc">True</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">nlayers</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">numID</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">padding</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">padonly</span> <span class="p">[</span><span class="n">scalar</span> <span class="o">=</span> <span class="kc">False</span><span class="p">]</span>
    <span class="o">*</span> <span class="n">shape</span> <span class="p">[</span><span class="nb">tuple</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">)]</span>
</pre></div>
</div>
<p>We omitted the result for the complete file to save some space but you
are encouraged to try:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.inspect /tmp/ptypy/recons/minimal/minimal_DM.ptyr
</pre></div>
</div>
</section>
<section id="create-a-new-template-for-a-reconstruction-script">
<h3>Create a new template for a reconstruction script<a class="headerlink" href="#create-a-new-template-for-a-reconstruction-script" title="Permalink to this headline">¶</a></h3>
<p>[WIP] Due to wildcards and links in the parameter tree, this section will be reworked.</p>
</section>
<section id="run-a-plotclient-in-a-separate-process">
<span id="plotclient"></span><h3>Run a plotclient in a separate process<a class="headerlink" href="#run-a-plotclient-in-a-separate-process" title="Permalink to this headline">¶</a></h3>
<p>PtyPy supports a Client/Server approach. That means that the
reconstruction process runs on a remote server (cluster) while we can
monitor the progress on a local machine.</p>
<p>In this case, we need to start a plotting Client on a separate machine).
You can implement your own plotting client but you may find it convenient
to use the plotting utility <code class="docutils literal notranslate"><span class="pre">ptypy.plotclient</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ptypy.plotclient [-h] [-l LAYOUT] [--dump] [--movie] [-i INTERVAL] [-d DIRECTORY]
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>None of the options are currently implemented. The plotting client receives all
information from the server it connects to. Work in progress ..</p>
</div>
</section>
</section>
<section id="more-script-templates">
<h2>More script templates<a class="headerlink" href="#more-script-templates" title="Permalink to this headline">¶</a></h2>
<p>Besides the script from which section <a class="reference internal" href="#quickstart"><span class="std std-ref">Quickstart with a minimal script</span></a> was generated,
there is a trinity of similar scripts at your disposal that
you can temper with.</p>
<section id="all-in-one">
<h3>All-in-one<a class="headerlink" href="#all-in-one" title="Permalink to this headline">¶</a></h3>
<p>We encourage you to use the script <code class="docutils literal notranslate"><span class="pre">[ptypy_root]/templates/ptypy_minimal_prep_and_run.py</span></code>
and modify the <em>recipe</em> part of the data parameter branch.
Observe what changes in the reconstruction when scan parameters change.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd">This script is a test for ptychographic reconstruction in the absence</span>
<span class="linenos"> 3</span><span class="sd">of actual data. It uses the test Scan class</span>
<span class="linenos"> 4</span><span class="sd">`ptypy.core.data.MoonFlowerScan` to provide &quot;data&quot;.</span>
<span class="linenos"> 5</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">ptypy.core</span> <span class="kn">import</span> <span class="n">Ptycho</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">ptypy</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">u</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="linenos">10</span><span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="n">p</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">13</span>
<span class="linenos">14</span><span class="c1"># for verbose output</span>
<span class="linenos">15</span><span class="n">p</span><span class="o">.</span><span class="n">verbose_level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="c1"># set home path</span>
<span class="linenos">18</span><span class="n">p</span><span class="o">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">19</span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;ptypy&quot;</span><span class="p">])</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="c1"># saving intermediate results</span>
<span class="linenos">22</span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">autosave</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c1"># opens plotting GUI if interaction set to active)</span>
<span class="linenos">25</span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">autoplot</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">26</span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">interaction</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="c1"># max 200 frames (128x128px) of diffraction data</span>
<span class="linenos">29</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">30</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">31</span><span class="c1"># now you have to specify which ScanModel to use with scans.XX.name,</span>
<span class="linenos">32</span><span class="c1"># just as you have to give &#39;name&#39; for engines and PtyScan subclasses.</span>
<span class="linenos">33</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;BlockVanilla&#39;</span> <span class="c1"># or &#39;BlockFull&#39;</span>
<span class="linenos">34</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">35</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;MoonFlowerScan&#39;</span>
<span class="linenos">36</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="mi">128</span>
<span class="linenos">37</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">=</span> <span class="mi">200</span>
<span class="linenos">38</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="kc">None</span>
<span class="linenos">39</span>
<span class="linenos">40</span><span class="c1"># position distance in fraction of illumination frame</span>
<span class="hll"><span class="linenos">41</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="mf">0.2</span>
</span><span class="linenos">42</span><span class="c1"># total number of photon in empty beam</span>
<span class="hll"><span class="linenos">43</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">photons</span> <span class="o">=</span> <span class="mf">1e8</span>
</span><span class="linenos">44</span><span class="c1"># Gaussian FWHM of possible detector blurring</span>
<span class="hll"><span class="linenos">45</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">psf</span> <span class="o">=</span> <span class="mf">0.</span>
</span><span class="linenos">46</span>
<span class="linenos">47</span><span class="c1"># attach a reconstrucion engine</span>
<span class="linenos">48</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">49</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">50</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;DM&#39;</span>
<span class="linenos">51</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">numiter</span> <span class="o">=</span> <span class="mi">80</span>
<span class="linenos">52</span>
<span class="linenos">53</span><span class="c1"># prepare and run</span>
<span class="linenos">54</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">55</span>    <span class="n">P</span> <span class="o">=</span> <span class="n">Ptycho</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="creating-a-ptyd-data-file">
<h3>Creating a .ptyd data-file<a class="headerlink" href="#creating-a-ptyd-data-file" title="Permalink to this headline">¶</a></h3>
<p>We encourage you to use this script <code class="docutils literal notranslate"><span class="pre">[ptypy_root]/templates/ptypy_make_sample_ptyd.py</span></code>
to create various different samples and see what happens if the data
processing parameters are changed. If you have become curious, move
forward to <a class="reference internal" href="data_management.html#ptypy-data"><span class="std std-ref">Data management</span></a> and take a look at <a class="reference external" href="http://www.github.com/ptycho/ptypy/">PtyPy</a>’s data management.
Check out the data parameter branch <code class="xref py py-data docutils literal notranslate"><span class="pre">scan.data</span></code> for detailed parameter
descriptions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd">This script creates a sample *.ptyd data file using the built-in</span>
<span class="linenos"> 3</span><span class="sd">test Scan `ptypy.core.data.MoonFlowerScan`</span>
<span class="linenos"> 4</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 5</span><span class="kn">import</span> <span class="nn">time</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">ptypy</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">u</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">ptypy.core.data</span> <span class="kn">import</span> <span class="n">MoonFlowerScan</span>
<span class="linenos"> 8</span><span class="c1"># for verbose output</span>
<span class="linenos"> 9</span><span class="n">u</span><span class="o">.</span><span class="n">verbose</span><span class="o">.</span><span class="n">set_level</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="c1"># create data parameter branch</span>
<span class="hll"><span class="linenos">12</span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
</span><span class="hll"><span class="linenos">13</span><span class="n">data</span><span class="o">.</span><span class="n">dfile</span> <span class="o">=</span> <span class="s1">&#39;sample.ptyd&#39;</span>
</span><span class="hll"><span class="linenos">14</span><span class="n">data</span><span class="o">.</span><span class="n">num_frames</span> <span class="o">=</span> <span class="mi">200</span>
</span><span class="hll"><span class="linenos">15</span><span class="n">data</span><span class="o">.</span><span class="n">save</span> <span class="o">=</span> <span class="s1">&#39;append&#39;</span>
</span><span class="hll"><span class="linenos">16</span><span class="n">data</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="kc">None</span>
</span><span class="hll"><span class="linenos">17</span><span class="n">data</span><span class="o">.</span><span class="n">auto_center</span> <span class="o">=</span> <span class="kc">None</span>
</span><span class="hll"><span class="linenos">18</span><span class="n">data</span><span class="o">.</span><span class="n">rebin</span> <span class="o">=</span> <span class="kc">None</span>
</span><span class="hll"><span class="linenos">19</span><span class="n">data</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="kc">None</span>
</span><span class="linenos">20</span>
<span class="linenos">21</span><span class="c1"># create PtyScan instance</span>
<span class="linenos">22</span><span class="n">MF</span> <span class="o">=</span> <span class="n">MoonFlowerScan</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="n">MF</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="linenos">25</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
<span class="linenos">26</span>    <span class="c1"># autoprocess data</span>
<span class="linenos">27</span>    <span class="n">msg</span> <span class="o">=</span> <span class="n">MF</span><span class="o">.</span><span class="n">auto</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
<span class="linenos">28</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">29</span>    <span class="c1"># logs the out put of .auto() to terminal prompt</span>
<span class="linenos">30</span>    <span class="n">u</span><span class="o">.</span><span class="n">verbose</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">verbose</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="n">msg</span><span class="p">),</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;allprocesses&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</section>
<section id="loading-a-data-file-to-run-a-reconstruction">
<h3>Loading a data file to run a reconstruction<a class="headerlink" href="#loading-a-data-file-to-run-a-reconstruction" title="Permalink to this headline">¶</a></h3>
<p>The script <code class="docutils literal notranslate"><span class="pre">[ptypy_root]/templates/minimal_load_and_run.py</span></code>
should resembles the case of data analysis after the experiment has taken
place. Take a challenging sample data from before
and alter the reconstruction parameters and algorithms to find out if you
can make the recontruction converge. Check out the engine parameter
branch <a class="reference internal" href="parameters.html#id3" title="engine"><code class="xref py py-data docutils literal notranslate"><span class="pre">engine</span></code></a> for detailed parameter descriptions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 2</span><span class="sd">This script is a test for ptychographic reconstruction after an</span>
<span class="linenos"> 3</span><span class="sd">experiment has been carried out and the data is available in ptypy&#39;s</span>
<span class="linenos"> 4</span><span class="sd">data file format in the current directory as &quot;sample.ptyd&quot;. Use together</span>
<span class="linenos"> 5</span><span class="sd">with `ptypy_make_sample_ptyd.py`.</span>
<span class="linenos"> 6</span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">ptypy.core</span> <span class="kn">import</span> <span class="n">Ptycho</span>
<span class="linenos"> 8</span><span class="kn">from</span> <span class="nn">ptypy</span> <span class="kn">import</span> <span class="n">utils</span> <span class="k">as</span> <span class="n">u</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="kn">import</span> <span class="nn">tempfile</span>
<span class="linenos">11</span><span class="n">tmpdir</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">gettempdir</span><span class="p">()</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="n">p</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">14</span><span class="n">p</span><span class="o">.</span><span class="n">verbose_level</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
<span class="linenos">15</span><span class="n">p</span><span class="o">.</span><span class="n">io</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">16</span><span class="n">p</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">home</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">tmpdir</span><span class="p">,</span> <span class="s2">&quot;ptypy&quot;</span><span class="p">])</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">19</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">20</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">21</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;BlockVanilla&#39;</span>
<span class="linenos">22</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;PtydScan&#39;</span>
<span class="linenos">23</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;file&#39;</span>
<span class="linenos">24</span><span class="n">p</span><span class="o">.</span><span class="n">scans</span><span class="o">.</span><span class="n">MF</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">dfile</span> <span class="o">=</span> <span class="s1">&#39;sample.ptyd&#39;</span>
<span class="linenos">25</span>
<span class="linenos">26</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">27</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">28</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;DM&#39;</span>
<span class="linenos">29</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine00</span><span class="o">.</span><span class="n">numiter</span> <span class="o">=</span> <span class="mi">80</span>
<span class="linenos">30</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine01</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Param</span><span class="p">()</span>
<span class="linenos">31</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine01</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;ML&#39;</span>
<span class="linenos">32</span><span class="n">p</span><span class="o">.</span><span class="n">engines</span><span class="o">.</span><span class="n">engine01</span><span class="o">.</span><span class="n">numiter</span> <span class="o">=</span> <span class="mi">20</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">35</span>    <span class="n">P</span> <span class="o">=</span> <span class="n">Ptycho</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">level</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../content.html">
              <img class="logo" src="../_static/logo_100px.png" alt="Logo"/>
            </a></p>
<h3><a href="../content.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting started with Ptypy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-installation-instructions">General installation instructions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quickstart-with-a-minimal-script">Quickstart with a minimal script</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#preparing-the-parameter-tree">Preparing the parameter tree</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-ptypy">Running ptypy</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#utilies-binaries-for-convenience">Utilies/Binaries for convenience</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#plotting-from-a-reconstruction-dump-file-ptyr">Plotting from a reconstruction/dump file (*.ptyr)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inspecting-a-hdf5-compatible-file">Inspecting a hdf5 compatible file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-a-new-template-for-a-reconstruction-script">Create a new template for a reconstruction script</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-a-plotclient-in-a-separate-process">Run a plotclient in a separate process</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#more-script-templates">More script templates</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#all-in-one">All-in-one</a></li>
<li class="toctree-l3"><a class="reference internal" href="#creating-a-ptyd-data-file">Creating a .ptyd data-file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-a-data-file-to-run-a-reconstruction">Loading a data file to run a reconstruction</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="concept.html">Concepts and Classes</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_management.html">Data management</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameter tree structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="ptypy.html">ptypy package</a></li>
</ul>

  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../content.html"
                          title="previous chapter">Quicklinks</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="concept.html"
                          title="next chapter">Concepts and Classes</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/rst/getting_started.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="concept.html" title="Concepts and Classes"
             >next</a> |</li>
        <li class="right" >
          <a href="../content.html" title="Quicklinks"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../content.html">ptypy 0.8.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Getting started with Ptypy</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Pierre Thibault, Bjoern Enders and others.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.5.0.
    </div>
  </body>
</html>